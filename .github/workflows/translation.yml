# Workflow name
name: translations
on:
    push:
        branches-ignore:
            - 'dependabot/**' # ðŸ‘ˆ Excludes dependabot branches
            - 'main' # only run for non-main branches
jobs:
    translate-files:
        name: Translate localization files
        runs-on: ubuntu-latest
        steps:
            - name: 'Checkout repo'
              uses: actions/checkout@v2

            - name: Install localization package
              run: npm install -g i18n-auto-translation

            - name: Translate files
              id: translate
              uses: msnyder-msft/i18n-auto-translation-action@v1.0.0-alpha.5
              with:
                  provider: 'azure-official'
                  subscriptionKey: 'c75991581d0943b6a9215f31d474badd'
                  location: 'westus2'
                  filePath: './src/Resources/Locales/en/translation.json'
                  from: 'en'
                  to: 'de'
                  debug: true

            - name: Get current branch name
              id: branch_name
              run: echo ::set-output name=current_branch::${GITHUB_REF#refs/*/}

            - name: Commit changes
              uses: devops-infra/action-commit-push@master
              with:
                  github_token: '${{ secrets.GITHUB_TOKEN }}'
                  commit_prefix: '[Update Translations]'
                  commit_message: 'Adding updated localization files'
                  force: false
                  target_branch: ${{steps.vars.branch_name.current_branch}}
